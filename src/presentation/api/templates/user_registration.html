<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  {% if "email" in fields %}
  <title>Registration Form</title>
  {% else %}
  <title>We need to know something else</title>
  {% endif %}
  <link rel="stylesheet" href="{{ url_for('static', path='/user_register.css')}}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.33/moment-timezone-with-data.min.js"></script>
</head>

<body>
  
  {% if "email" in fields %}
  <h1>Registration Form</h1>
  {% else %}
  <h1>We need to know something else</h1>
  {% endif %}
  <form method="POST" action="/user/register">
    {% if "email" in fields %}
    <div class="form-group">
      <label for="email" required>Email:</label>
      <input type="email" id="email" name="email" required>
    </div>
    {% endif %}
    {% if "username" in fields %}
    <div class="form-group">
      <label for="username" required>Username:</label>
      <input type="text" id="username" name="username" required>
    </div>
    {% endif %}
    {% if "password" in fields %}
    <div class="form-group">
      <label for="password" required>Password:</label>
      <input type="password" id="password" name="password" required>
    </div>
    <div class="form-group">
      <label for="confirm_password" required>Confirm Password:</label>
      <input type="password" id="confirm_password" name="confirm_password" required>
      <span class="error-message" id="password-error"></span>
    </div>
    {% endif %}
    {% if "name" in fields %}
    <div class="form-group">
      <label for="name" required>First Name:</label>
      <input type="text" id="name" name="name" required>
    </div>
    {% endif %}
    {% if "given_name" in fields %}
    <div class="form-group">
      <label for="given-name">Given Name:</label>
      <input type="text" id="given-name" name="given_name">
    </div>
    {% endif %}
    {% if "family_name" in fields %}
    <div class="form-group">
      <label for="family-name">Family Name:</label>
      <input type="text" id="family-name" name="family_name">
    </div>
    {% endif %}
    {% if "middle_name" in fields %}
    <div class="form-group">
      <label for="middle-name">Middle Name:</label>
      <input type="text" id="middle-name" name="middle_name">
    </div>
    {% endif %}
    {% if "preferred_username" in fields %}
    <div class="form-group">
      <label for="preferred-username">Preferred Username:</label>
      <input type="text" id="preferred-username" name="preferred_username">
    </div>
    {% endif %}
    {% if "last_name" in fields %}
    <div class="form-group">
      <label for="last_name">Last Name:</label>
      <input type="text" id="last_name" name="last_name" required>
    </div>
    {% endif %}
    {% if "profile" in fields %}
    <div class="form-group">
      <label for="profile">Profile URL:</label>
      <input type="url" id="profile" name="profile">
    </div>
    {% endif %}
    {% if "picture" in fields %}
    <div class="form-group">
      <label for="picture">Picture URL:</label>
      <input type="url" id="picture" name="picture">
    </div>
    {% endif %}
    {% if "website" in fields %}
    <div class="form-group">
      <label for="website">Website URL:</label>
      <input type="url" id="website" name="website">
    </div>
    {% endif %}
    {% if "gender" in fields %}
    <div class="form-group">
      <label for="gender" required>Gender</label>
      <select id="gender" name="gender" class="form-control" required>
        <option value="">Your gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
        <option value="non-binary">Non-binary</option>
        <option value="genderqueer">Genderqueer</option>
        <option value="transgender">Transgender</option>
        <option value="intersex">Intersex</option>
        <option value="agender">Agender</option>
        <option value="bigender">Bigender</option>
        <option value="demigender">Demigender</option>
        <option value="pangender">Pangender</option>
        <option value="androgyne">Androgyne</option>
        <option value="neutrois">Neutrois</option>
        <option value="two-spirit">Two-spirit</option>
        <option value="third gender">Third gender</option>
        <option value="transmasculine">Transmasculine</option>
        <option value="transfeminine">Transfeminine</option>
        <option value="genderfluid">Genderfluid</option>
        <option value="gender questioning">Gender questioning</option>
        <option value="other">Other</option>
        <option value="none">Prefer not to say</option>
        <option value="cisgender male">Cisgender male</option>
        <option value="cisgender female">Cisgender female</option>
        <option value="cisgender">Cisgender</option>
        <option value="transsexual">Transsexual</option>
        <option value="transvestite">Transvestite</option>
        <option value="cross-dresser">Cross-dresser</option>
        <option value="drag king">Drag king</option>
        <option value="drag queen">Drag queen</option>
        <option value="androgynous">Androgynous</option>
        <option value="other-gendered">Other gendered</option>
        <option value="other-identified">Other identified</option>
        <option value="prefer not to disclose">Prefer not to disclose</option>
        <option value="queer">Queer</option>
        <option value="questioning">Questioning</option>
        <option value="fluid">Fluid</option>
        <option value="nonconforming">Non-conforming</option>
        <option value="neither">Neither</option>
        <option value="don't know">Don't know</option>
      </select>
    </div>
    {% endif %}
    {% if "phone_number" in fields %}
    <div class="form-group">
      <label for="phone_number" required>Phone Number:</label>
      <div class="phone-number-group">
        <select id="country_code" name="country_code">
          <option value="+1">+1</option>
          <option value="+44">+44</option>
          <option value="+375">+375</option>
          <option value="+48">+48</option>
        </select>
        <input type="text" id="phone_number" name="phone_number" required>
      </div>
    </div>
    {% endif %}
    {% if "birthdate" in fields %}
    <div class="form-group" required>
      <label for="birthdate">Birthdate</label>
      <input type="date" class="form-control" id="birthdate" name="birthdate" required>
    </div>
    {% endif %}
    {% if "zoneinfo" in fields %}
    <div class="form-group">
      <label for="zoneinfo" required>Timezone:</label>
      <select name="zoneinfo" id="zoneinfo" required>
        <option value="">Select Timezone</option>
        <script>
          var timezones = moment.tz.names();
          for (var i = 0; i < timezones.length; i++) {
            document.write("<option value=\"" + timezones[i] + "\">" + timezones[i] + "</option>");
          }
        </script>
      </select>
    </div>
    {% endif %}
    {% if "address" in fields %}
    <div class="form-group">
      <label for="address" required>Address:</label>
      <input type="text" id="address" name="address" required>
    </div>
    {% endif %}
    <div class="form-group">
      <input type="checkbox" id="terms" name="terms" required>
      <label for="terms">I agree to the terms and conditions.</label>
    </div>
    <div class="form-group">
      <input type="submit" value="Register">
    </div>
  </form>
  <script src="{{ url_for('static', path='/user_register.js')}}"></script>
  <script>
    document.getElementById('register-form').addEventListener('submit', function (event) {
      event.preventDefault(); // prevent form submission

      fetch('/user/register', {
        method: 'POST',
        body: new FormData(document.getElementById('register-form'))
      }).then(function (response) {
        if (!response.ok) { // check for non-200 status code
          alert('Registration failed!');
        } else {
          response.text().then(function (text) {
            // handle successful response
          });
        }
      }).catch(function (error) {
        console.error(error);
        alert('An error occurred during registration!');
      });
    });
  </script>
</body>

</html>